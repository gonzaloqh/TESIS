name: Sync to Google Drive (Windows)

on:
  push:
    branches:
      - master  # Cambia esto si usas otra rama

jobs:
  sync:
    runs-on: windows-latest  # Usa una m√°quina con Windows

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install rclone
        run: |
          Invoke-WebRequest -Uri https://downloads.rclone.org/rclone-current-windows-amd64.zip -OutFile rclone.zip
          Expand-Archive -Path rclone.zip -DestinationPath C:\rclone
          echo "C:\rclone" | Out-File -Append -Encoding ASCII $env:GITHUB_PATH

      - name: Configure rclone
        run: |
          mkdir -Force $env:APPDATA\rclone
          Set-Content -Path "$env:APPDATA\rclone\rclone.conf" -Value "${{ secrets.RCLONE_CONFIG }}" -Encoding UTF8

      - name: Verify rclone configuration
        run: C:\rclone\rclone.exe listremotes --config "$env:APPDATA\rclone\rclone.conf"

      - name: Upload files to Google Drive
        run: |
          C:\rclone\rclone.exe sync "$PWD" "gdrive:/" --config "$env:APPDATA\rclone\rclone.conf" --drive-root-folder-id 1Nj5B-9tkfQGGBLesUBZeC77DRVYSWQeS --fast-list --exclude ".git/**" --transfers 10
